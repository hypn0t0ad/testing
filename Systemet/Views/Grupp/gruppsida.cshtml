@model Tuple<Systemet.Models.Grupp, ICollection<Systemet.Models.Evenemang>, ICollection<Systemet.Models.Uppgifter>>
@{
    <link rel="stylesheet" href="~/Content/Sensify.css">
    <link rel="stylesheet" href="~/Content/agenda.css">
    ViewBag.Title = "Gruppsida";
    TempData["användarID"] = Convert.ToInt32(Session["AnvändarID"]);
}
<ol class="breadcrumb">
    <li>@Html.ActionLink("Startsidan", "inloggad", "Konto")</li>
    <li>@Html.ActionLink("Alla mina grupper", "minagrupper", "Grupp")</li>
    <li class="active">@Model.Item1.GruppNamn</li>
</ol>


@{ var grupper = Model.Item1.GruppMedlemmar.Where(m => m.AnvändarID == (Convert.ToInt32(TempData["användarID"]))).ToList();

}

@foreach (var gr in grupper)
{
    <div class="well-lg" style="background-color:#eee">
        <div class="container-fluid">
            <input type="submit" value="Alla evenemang" class="btn btn-lg btn-danger" id="gruppknapp" style="font-size:x-large" />

            @*START KALENDER*@
            <div class="agenda">
                <div class="table-responsive col-sm-12">
                    <table class="table table-condensed table-responsive">
                        <thead>
                            <tr>
                                <th>Datum</th>
                                <th>Tid</th>
                                <th>Evenemang</th>
                            </tr>
                        </thead>

                        @foreach (var ev in Model.Item2)
                        {
                            <tbody>
                                <tr class="table">
                                    <td class="agenda-date active" style="background-color:#eee" rowspan="@Model.Item2.Count()">
                                        <div class="dayofmonth">@ev.Tidpunkt.Day/@ev.Tidpunkt.Month</div>
                                        <div class="dayofweek">@ev.Tidpunkt.DayOfWeek</div>
                                        <div class="shortdate text-muted">@ev.Tidpunkt.Year</div>
                                    </td>
                                    <td class="agenda-time" style="background-color:#eee">
                                        @ev.Tidpunkt.ToShortTimeString();
                                    </td>
                                    <td class="agenda-events" style="background-color:#eee">
                                        <div class="agenda-event">

                                            <button class="btn btn-primary" type="button"
                                                    onclick="location.href='@Url.Action("evenemangssida", "Evenemangs", new { idet = ev.EvenemangID })'" title="@ev.EvenemangID">
                                                @ev.Namn <span class="badge">@ev.Åsikter.Count()</span>
                                            </button>

                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        }

                    </table>
                </div>

            </div>
        </div>
    </div>


    @*här börjar uppgiftsindelningen*@
    <div class="well-lg" style="background-color:#e0e0e0">
        <div class="container-fluid">
            <input type="submit" value="Alla uppgifter" class="btn btn-lg btn-danger" id="gruppknapp" style="font-size:x-large" />

            @*START KALENDER*@
            <div class="agenda">
                <div class="table-responsive col-sm-12">
                    <table class="table table-condensed table-responsive">
                        <thead>
                            <tr>
                                <th>Startdatum</th>
                                <th>Beskrivning</th>
                                <th>Uppgift</th>
                                <th>Ansvarig</th>
                                <th>Påbörjad</th>
                            </tr>
                        </thead>

                        @foreach (var ev in Model.Item3)
                        {
                            <tbody>
                                <tr class="table">

                                    <td class="agenda-date active" style="background-color:#e0e0e0" rowspan="@Model.Item2.Count()">
                                        <div class="dayofmonth">@ev.Startdatum.Day/@ev.Startdatum.Month</div>
                                        <div class="dayofweek">@ev.Startdatum.DayOfWeek</div>
                                        <div class="shortdate text-muted">@ev.Startdatum.Year</div>
                                    </td>

                                    <td class="agenda-time" style="background-color:#e0e0e0">
                                        @ev.Beskrivning
                                    </td>

                                    <td class="agenda-events" style="background-color:#e0e0e0">
                                        <div class="agenda-event">

                                            @*om inloggad är ansvarig för uppgiften*@
                                            @if (ev.Ansvarig.AnvändarID == Convert.ToInt32(Session["AnvändarID"]))
                                            {

                                                if (ev.Påbörjad == true)
                                                {
                                                    <button class="btn btn-primary" type="button" style="background-color:#3e8d27" id="edit"
                                                            onclick="location.href='@Url.Action("Edit", "uppgifter", new { id  = ev.UppgifterID })'" title="@ev.UppgifterID">
                                                        @ev.Namn <span class="badge">Påbörjad</span>
                                                    </button>
                                                }
                                                else if (ev.Påbörjad == false)
                                                {
                                                    <button class="btn btn-primary" type="button" style="background-color:#3e8d27" id="edit"
                                                            onclick="location.href='@Url.Action("Edit", "uppgifter", new { id  = ev.UppgifterID })'" title="@ev.UppgifterID">
                                                        @ev.Namn <span class="badge">ej påbörjad</span>
                                                    </button>
                                                }
                                                else if (ev.Påbörjad == true && ev.Utförd == true)
                                                {
                                                    <button class="btn btn-primary" type="button" style="background-color:#3e8d27; cursor: default">
                                                        @ev.Namn <span class="badge">Klar</span>
                                                    </button>
                                                }
                                            }
                                            @*om inloggad inte ansvarar för uppgiften, och inte är ledare*@
                                            else if (ev.Ansvarig.AnvändarID != Convert.ToInt32(Session["AnvändarID"]))
                                            {

                                                if (ev.Påbörjad == true)
                                                {
                                                    <button class="btn btn-primary" type="button" style="cursor: default">
                                                        @ev.Namn <span class="badge">Påbörjad</span>
                                                    </button>
                                                }
                                                else if (ev.Påbörjad == false)
                                                {
                                                    //om den är fri att ta på sig
                                                    if (ev.Ansvarig.AnvändarID == 0)
                                                    {
                                                        <button class="btn btn-primary" type="button" style="background-color:#808080" id="uppgiftssida">
                                                            onclick="location.href='@Url.Action("upgiftssida", "uppgifter", new { id = ev.UppgifterID })'" title="@ev.UppgifterID">
                                                            @ev.Namn <span class="badge">inte påbörjad</span>
                                                        </button>
                                                    }
                                                    //om den är upptagen av någon annan
                                                    else if (ev.Ansvarig.AnvändarID > 0 && ev.Ansvarig.AnvändarID != Convert.ToInt32(Session["AnvändarID"]))
                                                    {
                                                        <button class="btn btn-primary" type="button" style="cursor: default">
                                                            @ev.Namn <span class="badge">Klar</span>
                                                        </button>
                                                    }

                                                }
                                                else if (ev.Påbörjad == true && ev.Utförd == true)
                                                {
                                                    <button class="btn btn-primary" type="button" style="background-color:#3e8d27; cursor: default">
                                                        @ev.Namn <span class="badge">Klar</span>
                                                    </button>
                                                }

                                            }

                                        </div>
                                    </td>

                                    <td class="agenda-events" style="background-color:#e0e0e0">
                                        <div class="agenda-event">
                                            @if (ev.Ansvarig != null)
                                            {
                                                @ev.Ansvarig.HelaNamnet
                                            }
                                            else if (ev.Ansvarig == null)
                                            {
                                                <a>ingen har tagit på sig den här uppgiften än</a>
                                            }
                                        </div>

                                </tr>
                            </tbody>
                        }

                    </table>
                </div>

            </div>
        </div>
    </div>
}


<p>@Html.ActionLink("Lägg till Uppgift", "Create", "Uppgifter")</p>



@section Scripts {

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

}

